<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Real Car Racing Game</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
    margin: 0;
    background: #0f172a;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
    font-family: Arial, sans-serif;
    color: white;
}

canvas {
    background: #1e293b;
    border-radius: 14px;
    box-shadow: 0 0 40px rgba(0,0,0,.6);
}

.panel {
    text-align: center;
}

button {
    margin-top: 8px;
    padding: 6px 14px;
    border: none;
    border-radius: 6px;
    background: #22c55e;
    color: black;
    font-weight: bold;
    cursor: pointer;
}

.stats {
    display: flex;
    justify-content: space-between;
    margin-bottom: 6px;
    font-size: 14px;
}

/* Mobile Controls */
.mobile-controls {
    margin-top: 12px;
    display: flex;
    justify-content: space-between;
    gap: 20px;
}

.mobile-controls button {
    width: 100px;
    height: 50px;
    font-size: 22px;
    border-radius: 10px;
    background: #22c55e;
    border: none;
    font-weight: bold;
    touch-action: none;   /* üî• REQUIRED FOR MOBILE */
}

/* Hide touch buttons on desktop */
@media (min-width: 768px) {
    .mobile-controls {
        display: none;
    }
}
</style>
</head>

<body>

<div class="panel">
    <h2>üèé Real Car Racer</h2>

    <div class="stats">
        <div>Score: <span id="score">0</span></div>
        <div>High: <span id="high">0</span></div>
    </div>

    <canvas id="game" width="400" height="600"></canvas>

    <!-- Mobile Touch Controls -->
    <div class="mobile-controls">
        <button id="leftBtn">‚¨ÖÔ∏è</button>
        <button id="rightBtn">‚û°Ô∏è</button>
    </div>

    <button onclick="restart()">Restart</button>
</div>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

let score = 0;
let speed = 5;
let enemies = [];
let dir = 0;

let high = localStorage.getItem("carHigh") || 0;
document.getElementById("high").innerText = high;

// Prevent page scroll on mobile
document.body.addEventListener("touchmove", e => e.preventDefault(), { passive: false });

// Player
const player = {
    x: 180,
    y: 480,
    w: 40,
    h: 80,
    speed: 6
};

// Draw car
function drawCar(x, y, w, h, color) {
    ctx.fillStyle = color;
    ctx.beginPath();
    ctx.roundRect(x, y, w, h, 10);
    ctx.fill();

    ctx.fillStyle = "#94a3b8";
    ctx.fillRect(x + 8, y + 10, w - 16, 18);
    ctx.fillRect(x + 8, y + h - 30, w - 16, 18);

    ctx.fillStyle = "#fde047";
    ctx.fillRect(x + 5, y + 2, 8, 6);
    ctx.fillRect(x + w - 13, y + 2, 8, 6);
}

// Spawn enemies
function spawnEnemy() {
    let lane = Math.floor(Math.random() * 3);
    enemies.push({
        x: 110 + lane * 60,
        y: -100,
        w: 40,
        h: 80
    });
}

// Keyboard controls
document.addEventListener("keydown", e => {
    if (e.key === "ArrowLeft") dir = -1;
    if (e.key === "ArrowRight") dir = 1;
});
document.addEventListener("keyup", () => dir = 0);

// ‚úÖ MOBILE BUTTON FIX (POINTER EVENTS)
const leftBtn = document.getElementById("leftBtn");
const rightBtn = document.getElementById("rightBtn");

leftBtn.addEventListener("pointerdown", () => dir = -1);
leftBtn.addEventListener("pointerup", () => dir = 0);
leftBtn.addEventListener("pointerleave", () => dir = 0);

rightBtn.addEventListener("pointerdown", () => dir = 1);
rightBtn.addEventListener("pointerup", () => dir = 0);
rightBtn.addEventListener("pointerleave", () => dir = 0);

// Click fallback (extra safety)
leftBtn.addEventListener("click", () => {
    dir = -1;
    setTimeout(() => dir = 0, 100);
});
rightBtn.addEventListener("click", () => {
    dir = 1;
    setTimeout(() => dir = 0, 100);
});

// Draw road
function drawRoad() {
    ctx.fillStyle = "#334155";
    ctx.fillRect(80, 0, 240, canvas.height);

    ctx.strokeStyle = "white";
    ctx.setLineDash([20, 20]);
    ctx.lineWidth = 4;
    ctx.beginPath();
    ctx.moveTo(200, 0);
    ctx.lineTo(200, canvas.height);
    ctx.stroke();
    ctx.setLineDash([]);
}

// Collision
function hit(a, b) {
    return !(a.x + a.w < b.x || a.x > b.x + b.w ||
             a.y + a.h < b.y || a.y > b.y + b.h);
}

// Game loop
function game() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    drawRoad();

    player.x += dir * player.speed;
    player.x = Math.max(80, Math.min(player.x, 280));
    drawCar(player.x, player.y, player.w, player.h, "#22c55e");

    enemies.forEach((e, i) => {
        e.y += speed;
        drawCar(e.x, e.y, e.w, e.h, "#ef4444");

        if (hit(player, e)) {
            if (score > high) localStorage.setItem("carHigh", score);
            alert("Game Over! Score: " + score);
            restart();
        }

        if (e.y > canvas.height) {
            enemies.splice(i, 1);
            score++;
            document.getElementById("score").innerText = score;
            speed += 0.2;
        }
    });

    requestAnimationFrame(game);
}

// Restart
function restart() {
    enemies = [];
    score = 0;
    speed = 5;
    player.x = 180;
    document.getElementById("score").innerText = 0;
}

setInterval(spawnEnemy, 1200);
game();
</script>

</body>
</html>
